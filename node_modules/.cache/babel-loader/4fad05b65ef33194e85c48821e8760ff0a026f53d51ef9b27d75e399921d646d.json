{"ast":null,"code":"import{Contracts_MetaMask}from\"../../contract/contracts\";import{useState,useEffect,useRef}from\"react\";import{useParams}from\"react-router-dom\";import Login from\"../../contract/login\";//cssをimport\nimport\"./user_page.css\";import History_list from\"./component/history_list\";import User_card from\"./component/user_card\";import{icons}from\"react-icons/lib\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function User_page(){const{address}=useParams();//User_cardへの表示用\nconst[icons,SetIcons]=useState(null);const[user_name,Setuser_name]=useState(null);const[result,SetResult]=useState(null);const[token,Set_token]=useState(null);const[state,Set_state]=useState(null);const[rank,setRank]=useState(null);const[num_of_student,setNum_of_student]=useState(null);//クイズの総数\nconst[history_sum,Set_history_sum]=useState(null);//現在表示している個数を保持するref\nconst now_numRef=useRef(0);const targetRef=useRef(null);// ターゲット要素のrefを作成\nlet cont=new Contracts_MetaMask();const[history_list,Set_history_list]=useState([]);const get_variable=async()=>{Set_token(await cont.get_token_balance(address));let[user_name,image,result,state]=await cont.get_user_data(address);console.log(user_name,image,state);Setuser_name(user_name);SetIcons(image);SetResult(result/10**18);setRank(await cont.get_rank(result));setNum_of_student(await cont.get_num_of_students());Set_state(state);cont.get_user_history_len(address).then(data=>{// Promise オブジェクトが解決された後の処理を記述\nconsole.log(Number(data));Set_history_sum(Number(data));now_numRef.current=Number(data);});};//初回のみ実行\nuseEffect(()=>{get_variable();},[]);if(history_sum!=null){return/*#__PURE__*/_jsxs(\"div\",{className:\"mypage\",children:[/*#__PURE__*/_jsx(User_card,{address:address,icons:icons,user_name:user_name,token:token,result:result,state:state,rank:rank,num_of_student:num_of_student,cont:cont}),/*#__PURE__*/_jsx(History_list,{cont:cont,history_sum:history_sum,Set_history_sum:Set_history_sum,history_list:history_list,Set_history_list:Set_history_list,targetRef:targetRef,now_numRef:now_numRef,address:address}),/*#__PURE__*/_jsxs(\"div\",{className:\"token-history\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"title\",children:\"Token History\"}),/*#__PURE__*/_jsx(\"div\",{className:\"timeline\",children:history_list.map((history,index)=>{// console.log(quiz);\nreturn/*#__PURE__*/_jsx(_Fragment,{children:history});})}),/*#__PURE__*/_jsx(\"div\",{ref:targetRef,children:\"now_loading\"})]})]});}else{return/*#__PURE__*/_jsx(_Fragment,{});}}export default User_page;","map":{"version":3,"names":["Contracts_MetaMask","useState","useEffect","useRef","useParams","Login","History_list","User_card","icons","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","User_page","address","SetIcons","user_name","Setuser_name","result","SetResult","token","Set_token","state","Set_state","rank","setRank","num_of_student","setNum_of_student","history_sum","Set_history_sum","now_numRef","targetRef","cont","history_list","Set_history_list","get_variable","get_token_balance","image","get_user_data","console","log","get_rank","get_num_of_students","get_user_history_len","then","data","Number","current","className","children","map","history","index","ref"],"sources":["C:/Users/takap/OneDrive - Chiba Institute of Technology/デスクトップ/web3-sotuken/src/pages/user_page/user_page.jsx"],"sourcesContent":["import {Contracts_MetaMask} from \"../../contract/contracts\";\r\nimport {useState, useEffect, useRef} from \"react\";\r\nimport {useParams} from \"react-router-dom\";\r\nimport Login from \"../../contract/login\";\r\n//cssをimport\r\nimport \"./user_page.css\";\r\nimport History_list from \"./component/history_list\";\r\nimport User_card from \"./component/user_card\";\r\nimport {icons} from \"react-icons/lib\";\r\n\r\nfunction User_page() {\r\n    const {address} = useParams();\r\n\r\n    //User_cardへの表示用\r\n    const [icons, SetIcons] = useState(null);\r\n    const [user_name, Setuser_name] = useState(null);\r\n\r\n    const [result, SetResult] = useState(null);\r\n    const [token, Set_token] = useState(null);\r\n    const [state, Set_state] = useState(null);\r\n    const [rank, setRank] = useState(null);\r\n    const [num_of_student, setNum_of_student] = useState(null); \r\n    //クイズの総数\r\n    const [history_sum, Set_history_sum] = useState(null);\r\n    //現在表示している個数を保持するref\r\n    const now_numRef = useRef(0);\r\n    const targetRef = useRef(null); // ターゲット要素のrefを作成\r\n\r\n    let cont = new Contracts_MetaMask();\r\n    const [history_list, Set_history_list] = useState([]);\r\n\r\n    const get_variable = async () => {\r\n        Set_token(await cont.get_token_balance(address));\r\n        let [user_name, image, result, state] = await cont.get_user_data(address);\r\n        console.log(user_name, image, state);\r\n        Setuser_name(user_name);\r\n        SetIcons(image);\r\n        SetResult(result / 10 ** 18);\r\n        setRank(await cont.get_rank(result));\r\n        setNum_of_student(await cont.get_num_of_students());\r\n        Set_state(state);\r\n\r\n        cont.get_user_history_len(address).then((data) => {\r\n            // Promise オブジェクトが解決された後の処理を記述\r\n            console.log(Number(data));\r\n            Set_history_sum(Number(data));\r\n            now_numRef.current = Number(data);\r\n        });\r\n    };\r\n\r\n    //初回のみ実行\r\n    useEffect(() => {\r\n        get_variable();\r\n    }, []);\r\n\r\n    if (history_sum != null) {\r\n        return (\r\n            <div className=\"mypage\">\r\n                <User_card address={address} icons={icons} user_name={user_name} token={token} result={result} state={state} rank={rank} num_of_student={num_of_student} cont={cont} />\r\n                <History_list cont={cont} history_sum={history_sum} Set_history_sum={Set_history_sum} history_list={history_list} Set_history_list={Set_history_list} targetRef={targetRef} now_numRef={now_numRef} address={address} />\r\n\r\n                <div className=\"token-history\">\r\n                    <div className=\"title\">Token History</div>\r\n                    <div className=\"timeline\">\r\n                        {history_list.map((history, index) => {\r\n                            // console.log(quiz);\r\n                            return <>{history}</>;\r\n                        })}\r\n                    </div>\r\n                    <div ref={targetRef}>\r\n                        {/* ターゲット要素aの内容 */}\r\n                        now_loading\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    } else {\r\n        return <></>;\r\n    }\r\n}\r\n\r\nexport default User_page;\r\n"],"mappings":"AAAA,OAAQA,kBAAkB,KAAO,0BAA0B,CAC3D,OAAQC,QAAQ,CAAEC,SAAS,CAAEC,MAAM,KAAO,OAAO,CACjD,OAAQC,SAAS,KAAO,kBAAkB,CAC1C,MAAO,CAAAC,KAAK,KAAM,sBAAsB,CACxC;AACA,MAAO,iBAAiB,CACxB,MAAO,CAAAC,YAAY,KAAM,0BAA0B,CACnD,MAAO,CAAAC,SAAS,KAAM,uBAAuB,CAC7C,OAAQC,KAAK,KAAO,iBAAiB,CAAC,OAAAC,GAAA,IAAAC,IAAA,gCAAAC,QAAA,IAAAC,SAAA,gCAAAC,IAAA,IAAAC,KAAA,yBAEtC,QAAS,CAAAC,SAASA,CAAA,CAAG,CACjB,KAAM,CAACC,OAAO,CAAC,CAAGZ,SAAS,CAAC,CAAC,CAE7B;AACA,KAAM,CAACI,KAAK,CAAES,QAAQ,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAACiB,SAAS,CAAEC,YAAY,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CAEhD,KAAM,CAACmB,MAAM,CAAEC,SAAS,CAAC,CAAGpB,QAAQ,CAAC,IAAI,CAAC,CAC1C,KAAM,CAACqB,KAAK,CAAEC,SAAS,CAAC,CAAGtB,QAAQ,CAAC,IAAI,CAAC,CACzC,KAAM,CAACuB,KAAK,CAAEC,SAAS,CAAC,CAAGxB,QAAQ,CAAC,IAAI,CAAC,CACzC,KAAM,CAACyB,IAAI,CAAEC,OAAO,CAAC,CAAG1B,QAAQ,CAAC,IAAI,CAAC,CACtC,KAAM,CAAC2B,cAAc,CAAEC,iBAAiB,CAAC,CAAG5B,QAAQ,CAAC,IAAI,CAAC,CAC1D;AACA,KAAM,CAAC6B,WAAW,CAAEC,eAAe,CAAC,CAAG9B,QAAQ,CAAC,IAAI,CAAC,CACrD;AACA,KAAM,CAAA+B,UAAU,CAAG7B,MAAM,CAAC,CAAC,CAAC,CAC5B,KAAM,CAAA8B,SAAS,CAAG9B,MAAM,CAAC,IAAI,CAAC,CAAE;AAEhC,GAAI,CAAA+B,IAAI,CAAG,GAAI,CAAAlC,kBAAkB,CAAC,CAAC,CACnC,KAAM,CAACmC,YAAY,CAAEC,gBAAgB,CAAC,CAAGnC,QAAQ,CAAC,EAAE,CAAC,CAErD,KAAM,CAAAoC,YAAY,CAAG,KAAAA,CAAA,GAAY,CAC7Bd,SAAS,CAAC,KAAM,CAAAW,IAAI,CAACI,iBAAiB,CAACtB,OAAO,CAAC,CAAC,CAChD,GAAI,CAACE,SAAS,CAAEqB,KAAK,CAAEnB,MAAM,CAAEI,KAAK,CAAC,CAAG,KAAM,CAAAU,IAAI,CAACM,aAAa,CAACxB,OAAO,CAAC,CACzEyB,OAAO,CAACC,GAAG,CAACxB,SAAS,CAAEqB,KAAK,CAAEf,KAAK,CAAC,CACpCL,YAAY,CAACD,SAAS,CAAC,CACvBD,QAAQ,CAACsB,KAAK,CAAC,CACflB,SAAS,CAACD,MAAM,CAAG,EAAE,EAAI,EAAE,CAAC,CAC5BO,OAAO,CAAC,KAAM,CAAAO,IAAI,CAACS,QAAQ,CAACvB,MAAM,CAAC,CAAC,CACpCS,iBAAiB,CAAC,KAAM,CAAAK,IAAI,CAACU,mBAAmB,CAAC,CAAC,CAAC,CACnDnB,SAAS,CAACD,KAAK,CAAC,CAEhBU,IAAI,CAACW,oBAAoB,CAAC7B,OAAO,CAAC,CAAC8B,IAAI,CAAEC,IAAI,EAAK,CAC9C;AACAN,OAAO,CAACC,GAAG,CAACM,MAAM,CAACD,IAAI,CAAC,CAAC,CACzBhB,eAAe,CAACiB,MAAM,CAACD,IAAI,CAAC,CAAC,CAC7Bf,UAAU,CAACiB,OAAO,CAAGD,MAAM,CAACD,IAAI,CAAC,CACrC,CAAC,CAAC,CACN,CAAC,CAED;AACA7C,SAAS,CAAC,IAAM,CACZmC,YAAY,CAAC,CAAC,CAClB,CAAC,CAAE,EAAE,CAAC,CAEN,GAAIP,WAAW,EAAI,IAAI,CAAE,CACrB,mBACIhB,KAAA,QAAKoC,SAAS,CAAC,QAAQ,CAAAC,QAAA,eACnBzC,IAAA,CAACH,SAAS,EAACS,OAAO,CAAEA,OAAQ,CAACR,KAAK,CAAEA,KAAM,CAACU,SAAS,CAAEA,SAAU,CAACI,KAAK,CAAEA,KAAM,CAACF,MAAM,CAAEA,MAAO,CAACI,KAAK,CAAEA,KAAM,CAACE,IAAI,CAAEA,IAAK,CAACE,cAAc,CAAEA,cAAe,CAACM,IAAI,CAAEA,IAAK,CAAE,CAAC,cACvKxB,IAAA,CAACJ,YAAY,EAAC4B,IAAI,CAAEA,IAAK,CAACJ,WAAW,CAAEA,WAAY,CAACC,eAAe,CAAEA,eAAgB,CAACI,YAAY,CAAEA,YAAa,CAACC,gBAAgB,CAAEA,gBAAiB,CAACH,SAAS,CAAEA,SAAU,CAACD,UAAU,CAAEA,UAAW,CAAChB,OAAO,CAAEA,OAAQ,CAAE,CAAC,cAExNF,KAAA,QAAKoC,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC1BzC,IAAA,QAAKwC,SAAS,CAAC,OAAO,CAAAC,QAAA,CAAC,eAAa,CAAK,CAAC,cAC1CzC,IAAA,QAAKwC,SAAS,CAAC,UAAU,CAAAC,QAAA,CACpBhB,YAAY,CAACiB,GAAG,CAAC,CAACC,OAAO,CAAEC,KAAK,GAAK,CAClC;AACA,mBAAO5C,IAAA,CAAAE,SAAA,EAAAuC,QAAA,CAAGE,OAAO,CAAG,CAAC,CACzB,CAAC,CAAC,CACD,CAAC,cACN3C,IAAA,QAAK6C,GAAG,CAAEtB,SAAU,CAAAkB,QAAA,CACG,aAEvB,CAAK,CAAC,EACL,CAAC,EACL,CAAC,CAEd,CAAC,IAAM,CACH,mBAAOzC,IAAA,CAAAE,SAAA,GAAI,CAAC,CAChB,CACJ,CAEA,cAAe,CAAAG,SAAS"},"metadata":{},"sourceType":"module","externalDependencies":[]}